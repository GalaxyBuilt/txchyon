---
// src/pages/v3.astro - THE INTERACTIVE ECOSYSTEM PROTOTYPE
import { getCollection } from 'astro:content';
import Base from "@/layouts/Base.astro";
import Posts from "@/layouts/components/Posts.astro";
import Pagination from "@/layouts/components/Pagination.astro";
import { CATEGORY_HIERARCHY } from '@/lib/categories';

// Helper functions (same as index.astro)
function calculateReadTime(content, wordsPerMinute = 130) {
  if (!content) return 10;
  const plainText = content.replace(/---[\s\S]*?---/, '').replace(/```[\s\S]*?```/g, '').replace(/<[^>]*>/g, '').replace(/#{1,6}\s*/g, '').replace(/[\[\]\(\)]/g, ' ').replace(/\s+/g, ' ').trim();
  const wordCount = plainText.split(/\s+/).length;
  const minutes = Math.ceil(wordCount / wordsPerMinute);
  return Math.max(1, Math.min(minutes, 60));
}

function getPostReadTime(post) {
  if (post.data.readTime) return post.data.readTime;
  if (post.body) return calculateReadTime(post.body);
  const estimates = { 'getting-started': 8, 'security-privacy': 10, 'trading-investing': 12, 'defi-yield': 15, 'airdrop-farming': 12, 'infrastructure-tech': 14, 'tools-automation': 13, 'research-analysis': 15, 'regulatory-tax': 12, 'portfolio-management': 12, 'prediction-markets': 14 };
  return estimates[post.data.category] || 10;
}

const allPostsRaw = await getCollection('posts', ({ data }) => !data.draft);
const allPosts = allPostsRaw.map(post => ({ ...post, data: { ...post.data, readTime: getPostReadTime(post) } }));
const sortedPosts = allPosts.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
const featuredPost = sortedPosts[0];
const latestPosts = sortedPosts.slice(1, 8);
const categoryPosts = {};
const categoryPostCounts = {};

Object.keys(CATEGORY_HIERARCHY).forEach(category => {
  const allPostsInCategory = sortedPosts.filter(p => p.data.category === category);
  categoryPostCounts[category] = allPostsInCategory.length;
  categoryPosts[category] = allPostsInCategory.filter(p => p.slug !== featuredPost?.slug).slice(0, 3);
});

const gettingStartedPosts = sortedPosts.filter(p => p.data.category === 'getting-started' && p.slug !== featuredPost?.slug);
let quickWins = gettingStartedPosts.length >= 4 ? gettingStartedPosts.slice(0, 4) : sortedPosts.slice(0, 4);

const realisticStats = { guidesPublished: allPosts.length.toString(), activeReaders: "1,200+", protocolsCovered: "45+", monthsActive: "1" };
const matrixCategories = [...new Set(allPostsRaw.map(p => p.data.category))].slice(0, 6);
---

<Base title="Txchyon - The Ecosystem Prototype (V3)" description="Redesign prototype including Labs, Shop, and Services.">
  
  <!-- â‚¿ GENESIS TERMINAL PREVIEW (TOP LEVEL) -->
  <GenesisPreview />

  <!-- ðŸŒŸ HERO SECTION -->
  <section class="relative min-h-[90vh] overflow-hidden dark:bg-black bg-white flex items-center">
    <!-- Dark Mode: Space Background -->
    <div class="absolute inset-0 bg-black hidden dark:block">
      <div class="absolute inset-0">
        <div class="stars"></div>
        <div class="stars stars-2"></div>
        <div class="stars stars-3"></div>
    
    <div class="container relative z-10 mx-auto px-4 pt-28 pb-16 text-center">
      <div class="inline-flex items-center gap-2 dark:bg-white/5 bg-black/5 rounded-full px-5 py-2 mb-8 border border-cyan-500/20">
        <span class="text-cyan-500 font-bold text-xs tracking-widest uppercase">âš¡ FRESH LAUNCH â€¢ NO BULLSHIT â€¢ 100% FREE</span>
      </div>
      <h1 class="text-5xl md:text-7xl font-black mb-8 leading-tight">
        <span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-500 italic">DeFi Knowledge</span>
        <br />
        <span class="dark:text-white text-gray-900">Shouldn't Cost $5,000</span>
      </h1>
      <p class="text-xl dark:text-gray-400 text-gray-600 max-w-2xl mx-auto mb-12">
        We're giving away what "gurus" charge thousands for. Because in crypto, information wants to be free.
      </p>
      
      <div class="flex gap-4 justify-center mb-12">
        <a href="#start-learning" class="px-8 py-4 bg-cyan-500 text-black font-black uppercase tracking-widest hover:invert transition-all">ðŸš€ START LEARNING FREE</a>
        <a href="#why-free" class="px-8 py-4 border border-white/20 dark:text-white text-black font-black uppercase tracking-widest hover:bg-white hover:text-black transition-all">ðŸ¤” WHY FREE?</a>
      </div>

       <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto opacity-70">
          <div><div class="text-2xl font-black">{realisticStats.guidesPublished}</div><div class="text-[10px] uppercase tracking-widest">GUIDES</div></div>
          <div><div class="text-2xl font-black">{realisticStats.activeReaders}</div><div class="text-[10px] uppercase tracking-widest">READERS</div></div>
          <div><div class="text-2xl font-black">{realisticStats.protocolsCovered}</div><div class="text-[10px] uppercase tracking-widest">PROTOCOLS</div></div>
          <div><div class="text-2xl font-black text-green-500">$0</div><div class="text-[10px] uppercase tracking-widest">COST</div></div>
       </div>
    </div>
  </section>

  <!-- ðŸ¤” WHY FREE? -->
  <section id="why-free" class="py-20 border-y border-white/5 bg-zinc-950">
    <div class="container mx-auto px-4 max-w-5xl">
      <h2 class="text-4xl font-black text-center mb-16 italic tracking-tighter text-white">Wait... Why Free?</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
        <div class="p-8 bg-white/5 border border-white/10 rounded-2xl">
           <div class="text-3xl mb-4 text-center">ðŸŽ¯</div>
           <h4 class="font-bold text-white mb-2 text-center text-sm">Open Source Philosophy</h4>
           <p class="text-xs text-gray-500">Crypto was built on open source. Knowledge should flow freely, not be locked behind paywalls.</p>
        </div>
        <div class="p-8 bg-white/5 border border-white/10 rounded-2xl">
           <div class="text-3xl mb-4 text-center">âš¡</div>
           <h4 class="font-bold text-white mb-2 text-center text-sm">No Hidden Agenda</h4>
           <p class="text-xs text-gray-500">We're not selling courses. Not promoting shitcoins. Just sharing what works.</p>
        </div>
        <div class="p-8 bg-white/5 border border-white/10 rounded-2xl">
           <div class="text-3xl mb-4 text-center">ðŸ”“</div>
           <h4 class="font-bold text-white mb-2 text-center text-sm">Accessible to All</h4>
           <p class="text-xs text-gray-500">Whether you have $100 or $100,000 - knowledge should be equally accessible.</p>
        </div>
        <div class="p-8 bg-white/5 border border-white/10 rounded-2xl">
           <div class="text-3xl mb-4 text-center">ðŸŒ±</div>
           <h4 class="font-bold text-white mb-2 text-center text-sm">Grow With Us</h4>
           <p class="text-xs text-gray-500">We're building this in public. Your feedback shapes what we create next.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ðŸŽ¯ FEATURED DEEP DIVE -->
  <section class="py-20 bg-black">
    <div class="container mx-auto px-4 max-w-5xl">
       <div class="flex justify-between items-end mb-12">
          <div>
            <h2 class="text-4xl font-black text-white italic tracking-tighter">Featured Deep Dive</h2>
            <p class="text-gray-500 uppercase tracking-widest text-[10px] mt-2">Repository 01 // Archive // Latest</p>
          </div>
          <span class="text-green-500 font-mono text-[10px]">VERIFIED_ALPHA</span>
       </div>
       
       <div class="grid grid-cols-1 md:grid-cols-2 gap-12 bg-white/5 border border-white/10 p-12 rounded-3xl group">
          <div class="aspect-video bg-zinc-900 rounded-2xl overflow-hidden border border-white/10 relative">
             {featuredPost?.data?.image && <img src={featuredPost.data.image} class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all opacity-50 group-hover:opacity-100" />}
             <div class="absolute top-4 left-4 px-3 py-1 bg-black text-white text-[10px] uppercase font-black italic">FEATURED</div>
          </div>
          <div class="flex flex-col justify-center">
             <div class="text-cyan-500 text-[10px] font-black uppercase tracking-[0.3em] mb-4">#{featuredPost?.data?.category}</div>
             <h3 class="text-3xl font-black text-white mb-6 leading-tight">{featuredPost?.data?.title}</h3>
             <p class="text-gray-400 mb-8 max-w-sm line-clamp-3">{featuredPost?.data?.description}</p>
             <a href={`/blog/${featuredPost?.slug}`} class="inline-block px-10 py-4 bg-white text-black font-black uppercase text-xs hover:bg-cyan-500 transition-colors w-fit">Read Free Deep Dive</a>
          </div>
       </div>
    </div>
  </section>

  <!-- ðŸ•¹ï¸ EXECUTION HUB (FULL SCALE V3 MATRIX) -->
  <section class="py-32 bg-black text-white selection:bg-cyan-500 border-y border-white/10 font-mono relative overflow-hidden">
    <div class="container mx-auto px-4 relative z-10">
      <div class="flex flex-col md:flex-row justify-between items-center md:items-end mb-20 gap-8">
        <div>
          <h2 class="text-5xl md:text-7xl font-black mb-6 tracking-tighter uppercase italic leading-[0.85] text-white">
            The <span class="text-cyan-500">Execution</span><br/>Hub_
          </h2>
          <div class="h-1.5 w-32 bg-cyan-500 mb-4"></div>
          <p class="text-[10px] font-bold text-gray-400 tracking-[0.4em] uppercase">System Access // Multi-Protocol Interface</p>
        </div>
        
        <!-- Live System Stats -->
        <div class="flex gap-8 text-[10px] font-black items-center text-gray-400 uppercase tracking-widest border border-white/10 p-6 rounded-2xl bg-white/5 backdrop-blur-md">
          <div class="flex flex-col gap-1">
             <span class="opacity-50">Memory</span>
             <span class="text-cyan-500">128TB_USED</span>
          </div>
          <div class="w-px h-8 bg-white/10"></div>
          <div class="flex flex-col gap-1">
             <span class="opacity-50">Network</span>
             <span class="text-cyan-500">10GBIT/S</span>
          </div>
          <div class="w-px h-8 bg-white/10"></div>
          <div class="flex flex-col gap-1">
             <span class="opacity-50">Security</span>
             <span class="text-green-500">STABLE</span>
          </div>
        </div>
      </div>

      <!-- ðŸ›ï¸ EXECUTION HUB (6-PILLAR GRID) -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
        <!-- Mission 01: Execute (Labs) -->
        <div class="group relative overflow-hidden bg-gray-50/50 dark:bg-white/5 border border-gray-100 dark:border-white/10 p-10 hover:bg-gray-100 dark:hover:bg-white/10 transition-all cursor-pointer rounded-[2rem] shadow-xl">
          <div class="absolute top-0 right-0 p-6 opacity-20 text-[10px] dark:text-white text-gray-900 font-black">PROTOCOL_EXE_001</div>
          <div class="flex flex-col h-full justify-between min-h-[320px]">
            <div>
              <div class="text-cyan-500 text-[10px] font-black mb-4 tracking-[0.3em]">LAYER_01 // INFRASTRUCTURE</div>
              <h3 class="text-4xl font-black mb-6 italic dark:text-white text-gray-900 group-hover:text-cyan-500 transition-colors">EXECUTE</h3>
              <p class="text-sm dark:text-gray-400 text-gray-600 leading-relaxed italic">Institutional-grade research and execution terminals for Solomon and Bitcoin natives.</p>
            </div>
            <div class="flex flex-col gap-4">
              <a href="https://labs.txchyon.com" class="inline-block w-fit px-8 py-4 bg-gray-900 dark:bg-white dark:text-black text-white font-black text-xs uppercase tracking-widest hover:bg-cyan-500 dark:hover:bg-cyan-500 transition-colors rounded-xl shadow-lg">Launch Terminals</a>
            </div>
          </div>
        </div>

        <!-- Mission 02: Grow (Services) -->
        <div class="group relative overflow-hidden bg-gray-50/50 dark:bg-white/5 border border-gray-100 dark:border-white/10 p-10 hover:bg-gray-100 dark:hover:bg-white/10 transition-all cursor-pointer rounded-[2rem] shadow-xl">
          <div class="absolute top-0 right-0 p-6 opacity-20 text-[10px] dark:text-white text-gray-900 font-black">PROTOCOL_SRV_088</div>
          <div class="flex flex-col h-full justify-between min-h-[320px]">
             <div>
                <div class="text-purple-500 text-[10px] font-black mb-4 tracking-[0.3em]">LAYER_02 // ACTIVATION</div>
                <h3 class="text-4xl font-black mb-6 italic dark:text-white text-gray-900 group-hover:text-purple-500 transition-colors">GROW</h3>
                <p class="text-sm dark:text-gray-400 text-gray-600 mb-8 leading-relaxed italic">Professional marketing, narrative audits, and viral activation for elite protocols.</p>
             </div>
             <a href="/services" class="text-[11px] font-black text-purple-500 hover:tracking-[0.2em] transition-all uppercase underline decoration-2 underline-offset-8">Apply_For_Services â†’</a>
          </div>
        </div>

        <!-- Mission 03: Access (Shop) -->
        <div class="group relative overflow-hidden bg-gray-50/50 dark:bg-white/5 border border-gray-100 dark:border-white/10 p-10 hover:bg-gray-100 dark:hover:bg-white/10 transition-all cursor-pointer rounded-[2rem] shadow-xl">
          <div class="absolute top-0 right-0 p-6 opacity-20 text-[10px] dark:text-white text-gray-900 font-black">PROTOCOL_PASS_003</div>
          <div class="flex flex-col h-full justify-between min-h-[320px]">
             <div>
                <div class="text-orange-500 text-[10px] font-black mb-4 tracking-[0.3em]">LAYER_03 // MEMBERSHIP</div>
                <h3 class="text-4xl font-black mb-6 italic dark:text-white text-gray-900 group-hover:text-orange-500 transition-colors">ACCESS</h3>
                <p class="text-sm dark:text-gray-400 text-gray-600 mb-8 leading-relaxed italic">Institutional monthly passes and systematic playbook repository for serious capital.</p>
             </div>
             <a href="https://shop.txchyon.com" class="text-[11px] font-black text-orange-500 hover:tracking-[0.2em] transition-all uppercase underline decoration-2 underline-offset-8">Enter_Shop â†’</a>
          </div>
        </div>

        <!-- Mission 04: Alpha (Insider) -->
        <div class="group relative overflow-hidden bg-gray-50/50 dark:bg-white/5 border border-gray-100 dark:border-white/10 p-10 hover:bg-gray-100 dark:hover:bg-white/10 transition-all cursor-pointer rounded-[2rem] shadow-xl">
          <div class="absolute top-0 right-0 p-6 opacity-20 text-[10px] dark:text-white text-gray-900 font-black">PROTOCOL_ALPH_99</div>
          <div class="flex flex-col h-full justify-between min-h-[320px]">
            <div>
              <div class="text-yellow-500 text-[10px] font-black mb-4 tracking-[0.3em]">LAYER_04 // INTELLIGENCE</div>
              <h3 class="text-4xl font-black mb-6 italic dark:text-white text-gray-900 group-hover:text-yellow-500 transition-colors">ALPHA</h3>
              <p class="text-sm dark:text-gray-400 text-gray-600 leading-relaxed italic">Exclusive early DEX arbitrage, whitelists, and high-frequency discovery systems.</p>
            </div>
            <a href="/categories/alpha-insider" class="text-[11px] font-black text-yellow-500 hover:tracking-[0.2em] transition-all uppercase underline decoration-2 underline-offset-8">Explore_Alpha â†’</a>
          </div>
        </div>

        <!-- Mission 05: Tools (Automation) -->
        <div class="group relative overflow-hidden bg-gray-50/50 dark:bg-white/5 border border-gray-100 dark:border-white/10 p-10 hover:bg-gray-100 dark:hover:bg-white/10 transition-all cursor-pointer rounded-[2rem] shadow-xl">
          <div class="absolute top-0 right-0 p-6 opacity-20 text-[10px] dark:text-white text-gray-900 font-black">PROTOCOL_TOOL_404</div>
          <div class="flex flex-col h-full justify-between min-h-[320px]">
            <div>
              <div class="text-green-500 text-[10px] font-black mb-4 tracking-[0.3em]">LAYER_05 // AUTOMATION</div>
              <h3 class="text-4xl font-black mb-6 italic dark:text-white text-gray-900 group-hover:text-green-500 transition-colors">TOOLS</h3>
              <p class="text-sm dark:text-gray-400 text-gray-600 leading-relaxed italic">Proprietary trading bots, alert systems, and high-speed automation scripts.</p>
            </div>
            <a href="/categories/tools-automation" class="text-[11px] font-black text-green-500 hover:tracking-[0.2em] transition-all uppercase underline decoration-2 underline-offset-8">Deploy_Tools â†’</a>
          </div>
        </div>

        <!-- Mission 06: Master (Academy) -->
        <div class="group relative overflow-hidden bg-gray-50/50 dark:bg-white/5 border border-gray-100 dark:border-white/10 p-10 hover:bg-gray-100 dark:hover:bg-white/10 transition-all cursor-pointer rounded-[2rem] shadow-xl">
          <div class="absolute top-0 right-0 p-6 opacity-20 text-[10px] dark:text-white text-gray-900 font-black">PROTOCOL_EDU_011</div>
          <div class="flex flex-col h-full justify-between min-h-[320px]">
            <div>
              <div class="text-blue-500 text-[10px] font-black mb-4 tracking-[0.3em]">LAYER_06 // KNOWLEDGE</div>
              <h3 class="text-4xl font-black mb-6 italic dark:text-white text-gray-900 group-hover:text-blue-500 transition-colors">MASTER</h3>
              <p class="text-sm dark:text-gray-400 text-gray-600 leading-relaxed italic">The complete Txchyon repository. 11 learning paths covering every DeFi niche.</p>
            </div>
            <a href="#start-learning" class="text-[11px] font-black text-blue-500 hover:tracking-[0.2em] transition-all uppercase underline decoration-2 underline-offset-8">Begin_Mastery â†’</a>
          </div>
        </div>
      </div>

    </div>
  </section>


  <!-- ðŸ—ºï¸ LEARNING PATHS -->
  <section id="start-learning" class="py-20 bg-zinc-950">
    <div class="container mx-auto px-4 max-w-6xl">
      <div class="text-center mb-16">
        <h2 class="text-4xl font-black text-white italic tracking-tighter mb-4">Explore All 11 Learning Paths</h2>
        <p class="text-gray-500 uppercase tracking-[0.5em] text-[10px]">Knowledge Base // Open Access</p>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        {Object.entries(CATEGORY_HIERARCHY).map(([category, data]) => (
          <div class="bg-white/5 border border-white/10 p-6 rounded-2xl hover:border-cyan-500/50 transition-all">
            <div class="flex items-start gap-4 mb-4">
              <div class="text-3xl">{data.icon}</div>
              <div>
                <h3 class="text-lg font-black text-white">{data.name}</h3>
                <p class="text-[10px] text-gray-500 uppercase tracking-widest">{categoryPostCounts[category] || 0} guides</p>
              </div>
            </div>
            <p class="text-xs text-gray-500 mb-6 leading-relaxed">{data.description}</p>
            <div class="space-y-2 mb-6">
              {categoryPosts[category]?.slice(0, 2).map(post => (
                <a href={`/blog/${post.slug}`} class="block text-[10px] text-gray-400 hover:text-cyan-500 transition-colors line-clamp-1 border-l border-white/10 pl-3">
                  {post.data.title}
                </a>
              ))}
            </div>
            <a href={`/categories/${category}`} class="text-[10px] font-black uppercase text-cyan-500 tracking-widest hover:pl-2 transition-all">Explore Path â†’</a>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- âœ¨ EXCLUSIVE BONUS PILLARS -->
  <section class="py-20 bg-black border-t border-white/10">
     <div class="container mx-auto px-4 max-w-6xl">
        <h2 class="text-5xl font-black text-white italic text-center mb-20 tracking-tighter">Exclusive Bonus Pillars</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
           <!-- Alpha -->
           <div class="p-10 bg-white/5 border border-yellow-500/20 rounded-[2.5rem] relative overflow-hidden group">
              <div class="absolute top-0 right-0 p-6 opacity-10 text-4xl">âœ¨</div>
              <h3 class="text-2xl font-black text-white mb-4">Alpha & Insider Strategies ðŸ”’</h3>
              <p class="text-gray-400 text-sm mb-12">Exclusive early access plays, whitelist strategies, and high-frequency alpha.</p>
              <div class="grid grid-cols-2 gap-4 mb-12">
                 {['Early DEX Arbitrage', 'Memecoin & NFT Whitelists', 'High-Frequency Airdrops', 'Alpha Discovery Systems'].map(item => (
                   <div class="text-[10px] text-gray-500 border border-white/5 p-3 rounded-lg hover:bg-white/5 transition-colors">{item}</div>
                 ))}
              </div>
              <button class="w-full py-4 bg-yellow-500 text-black font-black uppercase text-xs tracking-[0.2em] hover:bg-white transition-all rounded-xl">Unlock Alpha Base</button>
           </div>
           
           <!-- Gaming -->
           <div class="p-10 bg-white/5 border border-purple-500/20 rounded-[2.5rem] relative overflow-hidden group">
              <div class="absolute top-0 right-0 p-6 opacity-10 text-4xl">âœ¨</div>
              <h3 class="text-2xl font-black text-white mb-4">Web3 Gaming & Metaverse ðŸ”’</h3>
              <p class="text-gray-400 text-sm mb-12">Insider gaming strategies, early access plays, and metaverse wealth building.</p>
              <div class="grid grid-cols-2 gap-4 mb-12">
                 {['Play-to-Earn Strategies', 'Metaverse Real Estate', 'NFT Game Assets', 'Guild Strategies'].map(item => (
                   <div class="text-[10px] text-gray-500 border border-white/5 p-3 rounded-lg hover:bg-white/5 transition-colors">{item}</div>
                 ))}
              </div>
              <button class="w-full py-4 bg-purple-500 text-black font-black uppercase text-xs tracking-[0.2em] hover:bg-white transition-all rounded-xl">Unlock Gaming Base</button>
           </div>
        </div>
        <p class="text-center text-[10px] text-gray-600 uppercase tracking-widest mt-12">The 11 main pillars remain 100% free. These bonus pillars contain premium content for dedicated members.</p>
     </div>
  </section>

  <style>
    .stars { position: absolute; inset: 0; background-image: radial-gradient(1px 1px at 20px 30px, #eee, transparent), radial-gradient(1px 1px at 40px 70px, #fff, transparent); background-repeat: repeat; background-size: 800px 800px; animation: twinkle 8s infinite; }
    @keyframes twinkle { 0%, 100% { opacity: 0.6; } 50% { opacity: 0.9; } }
    .shooting-star { position: absolute; left: -100px; width: 120px; height: 1px; background: linear-gradient(90deg, transparent, rgba(96, 165, 250, 0.4), transparent); animation: shoot 30s linear infinite; }
    @keyframes shoot { 0% { transform: translateX(0) translateY(0) rotate(30deg); opacity: 0; } 5% { opacity: 0.6; } 15% { transform: translateX(100vw) translateY(80px); opacity: 0; } }
  </style>

</Base>
